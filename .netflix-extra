#!/usr/bin/env bash
# Install SDKMAN! with the following snippet:
[[ -r ${HOME}/.sdkman ]] || curl -s "https://get.sdkman.io" | bash
source "${HOME}/.sdkman/bin/sdkman-init.sh"

# /opt/nflx
if is_mac; then
    export PATH=/opt/nflx:/opt/nflx/bin:$PATH
fi

alias todo="gvim ~/drive/todo"
alias nf="gvim ~/drive/todo-netflix.md"

alias awsdbtest_asapp="weep file --force arn:aws:iam::179727101194:role/platformserviceInstanceProfile -A arn:aws:iam::521597827845:role/PlatformserviceDynamodbRole"
alias awsdbprod_asapp="weep file --force arn:aws:iam::149510111645:role/platformserviceInstanceProfile -A arn:aws:iam::567395257996:role/PlatformserviceDynamodbRole"

# If running weep serve
export AWS_CONTAINER_CREDENTIALS_FULL_URI='http://localhost:9091/ecs/arn:aws:iam::567395257996:role/awsmanagement_dynamic_config_mgt'
alias awsdbtest="weep file arn:aws:iam::179727101194:role/platformserviceInstanceProfile -A arn:aws:iam::521597827845:role/PlatformserviceDynamodbRole"
alias awsdbprod="weep file arn:aws:iam::149510111645:role/platformserviceInstanceProfile -A arn:aws:iam::567395257996:role/PlatformserviceDynamodbRole"
alias awsdbtestdirect="weep file --force arn:aws:iam::521597827845:role/awsmanagementtest_dynamic_config_mgt"
alias awsdbproddirect="weep file --force arn:aws:iam::567395257996:role/awsmanagement_dynamic_config_mgt"
alias awstest="weep --force file arn:aws:iam::179727101194:role/nsacRole"
alias awsdeleng="weep file --force arn:aws:iam::149510111645:role/awsprod_deliveryeng"
alias weepls="alias awsdbtest awsdbprod awstest awsdeleng"

export NETFLIX_DEV=true

# For subscriberservice2
export DOCKER_DEFAULT_PLATFORM=linux/amd64

if [ -r ${HOME}/.gitconfig-netflix ]
then
    grep metatron ${HOME}/.gitconfig >/dev/null 2>&1
    if [ "$?" != 0 ]
    then
        cat ${HOME}/.gitconfig-netflix >> ${HOME}/.gitconfig
        cat ${HOME}/.gitconfig-netflix-ghes >> ${HOME}/.gitconfig
    fi
fi

# Establish my git credentials for Netflix by default
git config --global user.email 'satkinson@netflix.com'
git config --global user.name  'Steven Atkinson'

# NVM
export NVM_DIR="$HOME/.nvm"
[ ! -d "$NVM_DIR" ] && curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/refs/heads/master/install.sh | bash

# NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/nvm.sh" ] && nvm use 18 >/dev/null 2>&1  # This loads nvm using node 18
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

if is_mac; then
				#Delivery Engineering

				# kubectl
				[[ ":$PATH:" != *":$HOME/.kube/bin:"* ]] && export PATH="$HOME/.kube/bin:${PATH}"
				[[ ":$PATH:" != *":$HOME/.kube/bin:"* ]] && export PATH="$HOME/.kube/bin:${PATH}"

				source $HOME/.spinnaker-env.sh
fi

if is_coder_workspace; then
    curl "https://artifacts.netflix.net/package-tarballs/llm-netflix/install.sh" | sh  
else
    newt --app-type python cli install llm-netflix >/dev/null 2>&1
fi


alias listmodels='metatron curl -a copilotcp ''https://copilotcp.cluster.us-east-1.prod.cloud.netflix.net:8443/models/list_models?includeHidden=false'' | jq ''.models[].id'''

function models() {
  metatron curl -a copilotcp 'https://copilotcp.vip.us-east-1.prod.cloud.netflix.net:8443/models/list_models' \
    -H 'accept: application/json' | \
    jq -r '.models[] | .id + " (context size: " + (.contextSize | tostring) + ")"'
}
